
@{
    ViewBag.Title = "AddProduct";
    Layout = "~/Views/Shared/_layui.cshtml";
}
<script src="~/Scripts/Convert_Pinyin.js"></script>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 15px;margin-left:5px">
    <legend>产品信息</legend>
</fieldset>
<form class="layui-form" lay-filter="product" id="product">
    <div class="layui-tab layui-tab-brief" style="margin-left:5px;">
        <ul class="layui-tab-title">
            <li class="layui-this">基本信息</li>
            <li>计量单位</li>
            <li>其他</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:50px;padding-left:0px">名称</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="ProName" name="ProName" lay-filter="ProName" autocomplete="off" />
                    </div>
                    <div class="layui-input-inline" style="display:none">
                        <input class="layui-input" id="SID" name="SID" lay-filter="SID" autocomplete="off" />
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-30px">拼音码</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="PinyinCode" name="PinyinCode" lay-filter="PinyinCode" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:50px;padding-left:0px">编码</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="AssistCode" name="AssistCode" lay-filter="AssistCode" autocomplete="off" />
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-30px">类别</label>
                    <div class="layui-input-inline" style="width:180px">
                        <select class="layui-input" id="ClassID" name="ClassID" lay-filter="ClassID " lay-search>
                            <option value="">无</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:50px;padding-left:0px">规格</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="Specs" name="Specs" lay-filter="Specs" autocomplete="off" />
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-30px">型号</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="Model" name="Model" lay-filter="Model" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:50px;padding-left:0px">颜色</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="Colour" name="Colour" lay-filter="Colour" autocomplete="off" />
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-30px">尺码</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="Size" name="Size" lay-filter="Size" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:50px;padding-left:0px">产地</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="Place" name="Place" lay-filter="Place" autocomplete="off" />
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-30px">厂商</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="FactryName" name="FactryName" lay-filter="FactryName" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:50px;padding-left:0px">年份</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="Year" name="Year" lay-filter="Year" autocomplete="off" />
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-30px">条码</label>
                    <div class="layui-input-inline" style="width:180px">
                        <input class="layui-input" id="BarCode" name="BarCode" lay-filter="BarCode" autocomplete="off" />
                    </div>
                </div>
            </div>
            <div class="layui-tab-item">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:100px;margin-left:-30px">主计量单位</label>
                    <div class="layui-input-inline" style="width:120px">
                        <select type="text" name="MainUnit" id="MainUnit" lay-filter="MainUnit" lay-search>
                            <option value="">=请选择=</option>
                        </select>
                    </div>
                    <div class="layui-input-inline" style="margin-left:60px">
                        <input type="checkbox" name="OnlyUnit" title="单一计量单位" lay-filter="OnlyUnit" checked value="0"/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:100px;margin-left:-30px">辅助计量单位</label>
                    <div class="layui-input-inline" style="width:120px">
                        <select type="text" name="AssistUnit" id="AssistUnit" lay-filter="AssistUnit" lay-search disabled>
                            <option value="">=请选择=</option>
                        </select>
                    </div>
                    <label class="layui-form-label" style="width:50px;margin-left:-20px">转化率</label>
                    <div class="layui-input-inline" style="width:135px">
                        <input class="layui-input" id="AssistRate" name="AssistRate" lay-filter="AssistRate" autocomplete="off" disabled/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:100px;margin-left:-30px">采购显示单位</label>
                    <div class="layui-input-inline" style="width:120px">
                        <select type="text" name="PurchaseUnit" id="PurchaseUnit" lay-filter="PurchaseUnit">
                            <option value="">=请选择=</option>
                        </select>
                    </div>
                    <div class="layui-input-inline" style="margin-left:60px">
                        <input type="checkbox" name="IsFloat" title="浮动转化率" lay-filter="IsFloat" value="1" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:100px;margin-left:-30px">销售显示单位</label>
                    <div class="layui-input-inline" style="width:120px">
                        <select type="text" name="SaleUnit" id="SaleUnit" lay-filter="SaleUnit" >
                            <option value="">=请选择=</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:100px;margin-left:-30px">库存显示单位</label>
                    <div class="layui-input-inline" style="width:120px">
                        <select type="text" name="InventoryUnit" id="InventoryUnit" lay-filter="InventoryUnit">
                            <option value="">=请选择=</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-tab-item">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:80px">辅助信息1</label>
                    <div class="layui-input-block" style="margin-right:30px">
                        <input class="layui-input" id="Spare1" name="Spare1" lay-filter="Spare1" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:80px">辅助信息2</label>
                    <div class="layui-input-block" style="margin-right:30px">
                        <input class="layui-input" id="Spare2" name="Spare2" lay-filter="Spare2" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:80px">辅助信息3</label>
                    <div class="layui-input-block" style="margin-right:30px">
                        <input class="layui-input" id="Spare3" name="Spare3" lay-filter="Spare3" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:80px">辅助信息4</label>
                    <div class="layui-input-block" style="margin-right:30px">
                        <input class="layui-input" id="Spare4" name="Spare4" lay-filter="Spare4" autocomplete="off" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width:80px">辅助信息5</label>
                    <div class="layui-input-block" style="margin-right:30px">
                        <input class="layui-input" id="Spare5" name="Spare5" lay-filter="Spare5" autocomplete="off" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="product" style="margin-left:210px">提交</button>
            <button type="reset" class="layui-btn layui-btn-primary" style="margin-left:15px">重置</button>
        </div>
    </div>

</form>
<script type="text/javascript">
    layui.use(['form','element'], function () {
        var form = layui.form, element = layui.element;
        var $ = layui.$;
        form.render();
        $.ajax({
            url: '/Unit/GetUnitList',
            type: 'post',
            dataType: 'json',
            success: function (backData) {
                $.each(backData.data, function (key, val) {
                    var opt = $("<option></option>").val(val.ID).html(val.UnitName);
                    $('#MainUnit').append(opt);
                    form.render('select');
                });
            }
        });
        $.ajax({
            url: '/ProductClass/GetClassList',
            type: 'post',
            dataType: 'json',
            success: function (backData) {
                $.each(backData.data, function (key, val) {
                    var opt = $("<option></option>").val(val.value).html(val.text);
                    $('#ClassID').append(opt);
                    form.render('select');
                });
            }
        });
        form.on('submit(product)', function (data) {
            var formBody = data.field;
            console.log(formBody);
            //$.ajax({
            //    url: '/Product/AddProduct',
            //    data: { model: formBody },
            //    type: 'post',
            //    dataType: 'json',
            //    success: function (backData) {
            //        console.log(backData);
            //    }
            //});
            return false;
        });
        form.on('checkbox(OnlyUnit)', function (data) {
            if (data.elem.checked) {
                $('#AssistUnit').attr("disabled", "disabled");
                $('#AssistRate').attr("disabled", "disabled");
                form.render('select');
            } else {
                var sId = $('#MainUnit').val();
                console.log(sId);
                if (sId != '') {
                    $('#AssistUnit').attr("disabled", false);
                    $('#AssistRate').attr("disabled", false);
                    $('#AssistUnit').empty();
                    $.ajax({
                        url: '/Unit/GetUnitList',
                        type: 'post',
                        data: { sid: sId },
                        dataType: 'json',
                        success: function (backData) {
                            $.each(backData.data, function (key, val) {
                                var opt = $("<option></option>").val(val.ID).html(val.UnitName);
                                $('#AssistUnit').append(opt);
                                form.render('select');
                            });
                        }
                    });
                }
            }
        });
        form.on('select(MainUnit)', function (data) {
            var selectList = [$('#PurchaseUnit'), $('#SaleUnit'), $('#InventoryUnit')];
           var t1= $("#MainUnit option:selected").text();
            var v1 = data.value;
            var d = $('input:checkbox[name="OnlyUnit"]')[0].checked;
            var t2 = $("#AssistUnit option:selected").text();
            var v2 = $('#AssistUnit').val();
            var opt1 = $("<option></option>").val(v1).html(t1);
            var opt = $("<option></option>").val(v2).html(t2);
            $.each(selectList, function (key, item) {
                item.empty();
                item.append(opt1);
                if (!d) {
                    item.append(opt);
                }
                form.render('select');
            });
        });
        $('#ProName').blur(function () {
            var shortPY = pinyin.getCamelChars($('#ProName').val());
            $('#PinyinCode').val(shortPY);
        })
    })
</script>

